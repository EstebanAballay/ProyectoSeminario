version: '3.8'

services:
  cobro:
    container_name: cobro-service
    build:
      context: .
      dockerfile: ./apps/cobro/Dockerfile
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - PORT_COBRO=${PORT_COBRO}
      - NGROK_URL=${NGROK_URL}
      - NGROK_WEBHOOK_URL=${NGROK_WEBHOOK_URL} 
      - MP_SERVICE_URL=${MP_SERVICE_URL}
    env_file:
      - .env
    ports:
      - "3001:3001"
    networks:
      - backend-network

  mercadopago:
    container_name: mercadopago-service
    build:
      context: .
      dockerfile: ./apps/mercadopago/Dockerfile
    env_file: .env
    ports:
      - "3005:3005"
    networks:
      - backend-network
    volumes:
      - ./apps/mercadopago:/app
      - /app/node_modules

  # NUEVO SERVICIO: Ngrok para Webhooks autom√°ticos
  ngrok:
    image: ngrok/ngrok:latest
    container_name: ngrok-service
    restart: always
    environment:
      - NGROK_AUTHTOKEN=${NGROK_AUTHTOKEN}
    command:
      - "http"
      - "--domain=unmullioned-bethany-studiously.ngrok-free.dev"
      - "cobro-service:3001" 
    ports:
      - "4040:4040" # Interfaz para monitorear los Webhooks en localhost:4040
    networks:
      - backend-network
    depends_on:
      - cobro

networks:
  backend-network:
    driver: bridge